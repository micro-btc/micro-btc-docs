# Multi-Key Addresses

## Library Imports

```typescript
import * as btc from 'micro-btc-signer'
import * as secp from '@noble/secp256k1'
import * as base from '@scure/base' 
const toHex = secp.utils.bytesToHex
```

## Key Sets for Testing

```typescript
const keySets = [
  {
    priv: base.hex.decode('0000000000000000000000000000000000000000000000000000000000000001'),
    pub: base.hex.decode('030000000000000000000000000000000000000000000000000000000000000001'),
    schnorrPub: base.hex.decode('0101010101010101010101010101010101010101010101010101010101010101')
  },
  {
    priv: base.hex.decode('0000000000000000000000000000000000000000000000000000000000000002'),
    pub: base.hex.decode('030000000000000000000000000000000000000000000000000000000000000002'),
    schnorrPub: base.hex.decode('0202020202020202020202020202020202020202020202020202020202020202')
  },
  {
    priv: base.hex.decode('0000000000000000000000000000000000000000000000000000000000000003'),
    pub: base.hex.decode('030000000000000000000000000000000000000000000000000000000000000003'),
    schnorrPub: base.hex.decode('1212121212121212121212121212121212121212121212121212121212121212')
  }
]
```

## Classic Script Hash: 2 of \{A, B, C\}

### Code

```typescript
const scriptInfo = btc.p2ms(2, keySets.map(keySet => keySet.pub))
const scriptHashInfo = btc.p2sh(scriptInfo)
const script = toHex(scriptInfo.script)
const scriptHash = toHex(scriptHashInfo.script)
const address = scriptHashInfo.address
```

### Console

```typescript
> console.log(script)
5221030000000000000000000000000000000000000000000000000000000000000001210300000000000000000000000000000000000000000000000000000000000000022103000000000000000000000000000000000000000000000000000000000000000353ae
> console.log(scriptHash)
a9149d91c6de4eacde72a7cc86bff98d1915b3c7818f87
> console.log(address)
3G4AeQtzCLoDAyv2eb3UVTG5atfkyHtuRn
```

## SegWit Script Hash: 2 of \{A, B, C\}

### Code

```typescript
const scriptInfo = btc.p2ms(2, keySets.map(keySet => keySet.pub))
const scriptHashInfo = btc.p2wsh(scriptInfo)
const script = toHex(scriptInfo.script)
const scriptHash = toHex(scriptHashInfo.script)
const address = scriptHashInfo.address
```

### Console

```typescript
> console.log(script)
5221030000000000000000000000000000000000000000000000000000000000000001210300000000000000000000000000000000000000000000000000000000000000022103000000000000000000000000000000000000000000000000000000000000000353ae
> console.log(scriptHash)
002074ee2b4ceec10839a489c07d4a538384394681e3dcd88f3ee87a85199908aa5e
> console.log(address)
bc1qwnhzkn8wcyyrnfyfcp7555urssu5dq0rmnvg70hg02z3nxgg4f0qljmr2h
```

## Taproot Single-Leaf: 2 of \{A, B, C\}

### Code

```typescript
const leafScriptInfo = btc.p2tr_ms(2, keySets.map(k => k.schnorrPub))
const leafScript = toHex(leafScriptInfo.script)
const scriptInfo = btc.p2tr(undefined, leafScriptInfo)
const script = toHex(scriptInfo.script)
const address = scriptInfo.address
```

### Console

```typescript
> console.log(leafScript)
200101010101010101010101010101010101010101010101010101010101010101ac200202020202020202020202020202020202020202020202020202020202020202ba201212121212121212121212121212121212121212121212121212121212121212ba529c
> console.log(script)
5120d6d46cb316e98a2e639b9cc8ce54d73677ad7118a0d42fb95d53e0fb9a7c5fce
> console.log(address)
bc1p6m2xevckax9zucumnnyvu4xhxem66ugc5r2zlw2a20s0hxnutl8qfef23s
```

## Taproot Multi-Leaf: (A&B) or (A&C) or (B&C)

### Code

```typescript
const leafScriptInfo = btc.p2tr_ns(2, keySets.map(k => k.schnorrPub))
const leafScripts = leafScriptInfo.map(s => toHex(s.script))
const scriptInfo = btc.p2tr(undefined, leafScriptInfo)
const script = toHex(scriptInfo.script)
const address = scriptInfo.address
```

### Console

```typescript
> leafScripts.map(s => console.log(s))
200101010101010101010101010101010101010101010101010101010101010101ad200202020202020202020202020202020202020202020202020202020202020202ac
200101010101010101010101010101010101010101010101010101010101010101ad201212121212121212121212121212121212121212121212121212121212121212ac
200202020202020202020202020202020202020202020202020202020202020202ad201212121212121212121212121212121212121212121212121212121212121212ac
> console.log(script)
5120cb138dcec0001e5ed66f4c0f8f6ddfc6875ca401620800c99947ffd621ca8d12
> console.log(address)
bc1pevfcmnkqqq09a4n0fs8c7mwlc6r4efqpvgyqpjvegllavgw235fq3kz7a0
```

## Taproot Multi-Leaf: A or (B&C)

### Code

```typescript
export const makeTaprootLeafScript = (pubkeys: Uint8Array[]) => {
  return {
    type: 'tr_ns',
    script: btc.OutScript.encode({ type: 'tr_ns', pubkeys: pubkeys })
  }
}

const leafScriptInfo = [
    makeTaprootLeafScript(keySets[0].schnorrPub),
    makeTaprootLeafScript(keySets[1].schnorrPub, keySets[2].schnorrPub)
]
const leafScripts = leafScriptInfo.map(s => toHex(s.script))
const scriptInfo = btc.p2tr(undefined, leafScriptInfo)
const script = toHex(scriptInfo.script)
const address = scriptInfo.address
```

### Console

```typescript
> leafScripts.map(s => console.log(s))
200101010101010101010101010101010101010101010101010101010101010101ac
200202020202020202020202020202020202020202020202020202020202020202ad201212121212121212121212121212121212121212121212121212121212121212ac
> console.log(script)
512018505e0efa520aca611ed86166e3afa1fffacac761e22d02825d85429cdff404
> console.log(address)
bc1prpg9urh62g9v5cg7mpskdca058ll4jk8v83z6q5ztkz598xl7szqn2y4n7
```